<?php
//https://api.telegram.org/bot380289834:AAGjd6Q0j5F_1hToz92I4bJnKK94gmQNl00/
//sendmessage?text=hello&chat_id=276921476
//&reply_markup={%22resize_keyboard%22:true,%22keyboard%22:[[%22%D0%9F%D1%80%D0%B8%D0%B2%D0%B5%D1%82%22],[%22%D0%9F%D0%BE%D0%BA%D0%B0%22]]}
require('telegram/Bot.php');
require('bitly/RestApi.php');
require('Log/FLogger.php');

$log = new FLogger("log.txt");
$bot = new \telegram\Bot($log);
$bitlyApi = new bitly\RestApi();

$history = $bitlyApi->getExistLinks();
$content = "–ò—Å—Ç–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫: \n\n";
foreach ($history as $i) {
  $content .= $i['title'] . "\n";
  $content .= "üîó " . $i['long_url'] ."\n\n". "‚û° ". $i['link'] . "\n---------\n";
}
$bot->sendMessage($content, '321121687');

$log->log("–∑–∞–ø—Ä–æ—Å –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ");

$result = (array)$bot->getUpdates();
echo "<pre>";
var_dump($result);
echo "</pre>";

$chat_id = ((array)((array)((array)$result["result"][count($result["result"])-1])["message"])["chat"])["id"];
$log->log("id —á–∞—Ç–∞: ".$chat_id);

$log->log("–∑–∞–ø—Ä–æ—Å –ø—Ä–æ—à–µ–ª");


$log->log("–æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ");
$bot->sendMessage("hello", $chat_id);
$log->log("—Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ");

$log->log("—Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã");
$keyboards = [["–ü—Ä–∏"], ["–ü–æ–∫–∞"]];
$keyboardSettings = array(
    "resize_keyboard" => true,
);
$bot->keyboard(" f", $chat_id, $keyboards, $keyboardSettings);
$log->log("–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞");

$log->log("—Å–æ–∑–¥–∞–Ω–∏–µ —è—Ä–ª—ã–∫–∞");

$inlineKeyboards = [
    "inline_keyboard" => [
        [
            (object)[
                "text" => "<",
                "callback_data" => "google.com"

            ],
            (object)[
                "text" => ">",
                "callback_data" => 'google.com'
            ]
        ]
    ]
];

$bot->inlineKeyboard(" f", $chat_id, $inlineKeyboards);
$log->log("—è—Ä–ª—ã–∫ —Å–æ–∑–¥–∞–Ω");

